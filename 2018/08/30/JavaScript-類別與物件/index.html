<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description" content="網頁技術, 前端, 後端, 生活, 閱讀, 筆記"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>JavaScript 類別與物件 - 生活與技術</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com/cian6390"><span>Github</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="https://images2.imgbox.com/e1/ff/W42RCDl2_o.jpg"><div class="post-title"><h1 class="title">JavaScript 類別與物件</h1><ul class="meta"><li><i class="icon icon-author"></i>Cian</li><li><i class="icon icon-clock"></i>23 Minutes</li><li><i class="icon icon-calendar"></i>August 30, 2018</li></ul></div></div><div class="article-content" style="max-width:800px"><h1 id="類別-Class"><a href="#類別-Class" class="headerlink" title="類別 Class"></a>類別 Class</h1><p>ES6新增的類別<code>class</code>, 實際上只是一個語法糖, 在JS中並沒有真正的類別。<br>會新增類別<code>class</code>完全是因為更佳的語意化，開發者可以用更簡潔清晰的語法描述相同的需求。</p>
<blockquote>
<p>class 事實上還是一個 <em>function</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123; &#125;</span><br><span class="line"><span class="keyword">typeof</span> Car  <span class="comment">// "function"</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>關於如何建立類別以及繼承MDN已經有非常優秀的文章<a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Classes" target="_blank" rel="noopener">Classes</a><br>本文將討論更深入且有趣的特性以及操作方式</p>
<h2 id="Getter-and-Setter"><a href="#Getter-and-Setter" class="headerlink" title="Getter and Setter"></a>Getter and Setter</h2><p>在我們使用JS的<code>Getter/Setter</code>之前<br>為了保持資料的正確性，以及取得我們想要的資料格式<br>我們可能會寫這樣子的程式</p>
<h3 id="範例1-1"><a href="#範例1-1" class="headerlink" title="範例1-1"></a>範例1-1</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name</span><br><span class="line">        <span class="keyword">this</span>._email = <span class="literal">undefined</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setEmail(email) &#123;</span><br><span class="line">        <span class="comment">// 驗證 email ..</span></span><br><span class="line">        <span class="keyword">this</span>._email = email</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getEmail() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`Email: <span class="subst">$&#123;<span class="keyword">this</span>._email&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> peter = <span class="keyword">new</span> User(<span class="string">'Peter'</span>)</span><br><span class="line">peter.setEmail(<span class="string">'peter@mail.com'</span>)</span><br><span class="line">peter.getEmail()    <span class="comment">// "Email: peter@mail.com"</span></span><br></pre></td></tr></table></figure>
<p>我們知道JS先天缺乏物件導向中屬性的私有特性<br>因此 <strong>範例1-1</strong>中刻意使用 <em>_email</em>來強調該屬性為私有<br>不應該在外部被直接調用或修改，應該使用方法<em>setEmail</em>/<em>getEmail</em>來存取<br>這樣的使用方式在JS生態圈中隨處可見，早已成為慣例<br>但其實我們可以用<code>Getter/Setter</code>，把一樣的事情做得更好</p>
<h3 id="範例1-2"><a href="#範例1-2" class="headerlink" title="範例1-2"></a>範例1-2</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name</span><br><span class="line">        <span class="keyword">this</span>._email = <span class="literal">undefined</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    set email(email) &#123;</span><br><span class="line">        <span class="comment">// 驗證 email ..</span></span><br><span class="line">        <span class="keyword">this</span>._email = email</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get email() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`Email: <span class="subst">$&#123;<span class="keyword">this</span>._email&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 現在我們可以這樣寫</span></span><br><span class="line"><span class="keyword">const</span> reyes = <span class="keyword">new</span> User(<span class="string">'Reyes'</span>)</span><br><span class="line">reyes.email = <span class="string">'reyes@mail.com'</span></span><br><span class="line">reyes.email    <span class="comment">// "Email: reyes@mail.com"</span></span><br></pre></td></tr></table></figure>
<p>這是個小小的改進，但卻讓程式更加簡潔。<br>我們可以選擇性的使用<code>Getter/Setter</code>，可以同時使用，也可以擇一使用。<br>但這一樣沒有解決屬性私有的問題，我們依然可以直接通過修改 <em>_email</em>來改變物件屬性<br>因此我們還需要再多一點努力。</p>
<h3 id="範例1-3"><a href="#範例1-3" class="headerlink" title="範例1-3"></a>範例1-3</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserFactory</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> EMAIL = <span class="built_in">Symbol</span>()</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        set email(email) &#123;</span><br><span class="line">            <span class="comment">// 驗證 email ..</span></span><br><span class="line">            <span class="keyword">this</span>[EMAIL] = email</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        get email() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`Email: <span class="subst">$&#123;<span class="keyword">this</span>[EMAIL]&#125;</span>`</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> User(...args)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> roy = UserFactory(<span class="string">'Roy'</span>)</span><br><span class="line">roy.email = <span class="string">'roy@mail.com'</span></span><br><span class="line">roy.email    <span class="comment">// "Email: roy@mail.com"</span></span><br></pre></td></tr></table></figure>
<p>範例 <strong>範例1-3</strong>，使用了ES6添加的 <code>Symbol</code><br>通過<code>Symbol</code>我們可以建立絕對唯一的物件特性，絕不與其他特性衝突</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s1 = <span class="built_in">Symbol</span>(<span class="string">'Hello'</span>)</span><br><span class="line"><span class="keyword">const</span> s2 = <span class="built_in">Symbol</span>(<span class="string">'Hello'</span>)</span><br><span class="line">s1 === s2   <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>接著我們使用<code>工廠模式</code>封裝變數作用域，使其無法被直接存取<br>現在我們不僅保有了好用的<code>Getter/Setter</code>，同時也讓私有屬性更加安全。  </p>
<hr>
<h2 id="多重繼承-Mixin"><a href="#多重繼承-Mixin" class="headerlink" title="多重繼承 Mixin"></a>多重繼承 Mixin</h2><p>在真實世界中，很多時候不同的物件共用相同的東西是合理的<br>例如車子與房子雖然是完全不同的東西，但他們都有價值，能夠被抵押  </p>
<p>JS本身不僅沒有介面，同時又採用單一繼承的方式來避免多重繼承時造成 <strong>碰撞</strong>的風險<br>這又是一個JS被詬病的原因，但很多事情其實都有相應解決方案，JS剛好就有!!</p>
<p>首先我們都知道JS是原型繼承，有著一個叫做 <code>prototype</code>的東西</p>
<blockquote>
<p>如果你還不太清楚原型鏈，可以參考MSN優秀的<a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Inheritance_and_the_prototype_chain" target="_blank" rel="noopener">繼承與原型鏈</a>文件</p>
</blockquote>
<p>拜 <code>prototype</code>所賜我們可以簡單的將共用方法可提取出來給多個類別使用  </p>
<h3 id="範例2-1"><a href="#範例2-1" class="headerlink" title="範例2-1"></a>範例2-1</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 略 ..</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeMortgageable</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    object.addContract = <span class="function"><span class="keyword">function</span> (<span class="params">contract</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.contract = contract</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    object.getContract = <span class="function"><span class="keyword">function</span> (<span class="params">contract</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.contract</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">makeMortgageable(Car)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> car = <span class="keyword">new</span> Car</span><br><span class="line"><span class="keyword">const</span> exampleContract = &#123;&#125;</span><br><span class="line">car1.addContract(exampleContract)   <span class="comment">// "TypeError: car1.addContract is not a function"</span></span><br></pre></td></tr></table></figure>
<p><strong>範例2-1</strong>首先定義了Car類別，接著製作一個 <em>makeMortgageable</em>，用來添加方法給類別，但最後卻出現了<code>TypeError</code><br>原因在於範例中傳給 <em>makeMortgageable</em>的是建構子而不是實利，因此錯誤會是理所當然<br>一點點小小的修正就能使其正確執行</p>
<h3 id="範例-2-2"><a href="#範例-2-2" class="headerlink" title="範例 2-2"></a>範例 2-2</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 定義 Car ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定義 makeMortgageable function ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> car = <span class="keyword">new</span> Car</span><br><span class="line">makeMortgageable(car)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> exampleContract = &#123;&#125;</span><br><span class="line">car.addContract(exampleContract)</span><br><span class="line">car.getContract()   <span class="comment">// &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<p>只做了一點點順序的改變程式便可執行了<br>會有這樣的差異原因在於，<strong>範例2-1</strong>，傳給 <em>makeMortgageable</em>的參數並非物件實例<br>也因此<em>makeMortgageable</em>所添加的方法沒有添加到原型鏈，所以會執行失敗<br>而 <strong>範例2-2</strong>則是直接將 <em>makeMortgageable</em>裡所提供的方法添加給 car實例，因此正確執行<br>但如此一來，每次建立Car實例之後都要在執行 <em>makeMortgageable</em>並不是我們所想要的  </p>
<h3 id="範例2-3"><a href="#範例2-3" class="headerlink" title="範例2-3"></a>範例2-3</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeMortgageable</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    object.addContract = <span class="function"><span class="keyword">function</span> (<span class="params">contract</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.contract = contract</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    object.getContract = <span class="function"><span class="keyword">function</span> (<span class="params">contract</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.contract</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        makeMortgageable(Car.prototype)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> car = <span class="keyword">new</span> Car</span><br><span class="line"><span class="keyword">const</span> exampleContract = &#123;&#125;</span><br><span class="line">car.addContract(exampleContract)</span><br><span class="line">car.getContract()   <span class="comment">// &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>範例2-3</strong>，通過一點小小的變化<br>首先將 <em>makeMortgageable</em>放置於Car類別的 <em>constructor</em><br>接著將傳給 <em>makeMortgageable</em>的參數改為 Car的 <code>prototype</code><br>如此一來，便能確保每個Car實例中的原型鏈都能含有 <em>makeMortgageable</em>所提供的方法  </p>
<p>現在，想像 Car是個業務繁重的類別<br>有了這個模式之後，我們能將方法歸類成幾個 <code>module</code><br>接著在 <code>import</code>給需要使用到的腳本使用。 </p>
<hr>
<h2 id="Object-defineProperty"><a href="#Object-defineProperty" class="headerlink" title="Object.defineProperty"></a>Object.defineProperty</h2><p>最後我們使用<code>Object.defineProperty</code> 結合 <strong>範例2</strong>與 <code>Getter/Setter</code></p>
<h3 id="範例3"><a href="#範例3" class="headerlink" title="範例3"></a>範例3</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeMortgageable</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> CONTRACT = <span class="built_in">Symbol</span>()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(object, <span class="string">'contract'</span>, &#123;</span><br><span class="line">        set(contract) &#123;</span><br><span class="line">            <span class="keyword">this</span>[CONTRACT] = contract</span><br><span class="line">        &#125;,</span><br><span class="line">        get() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>[CONTRACT]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        makeMortgageable(Car.prototype)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> car = <span class="keyword">new</span> Car</span><br><span class="line"><span class="keyword">const</span> exampleContract = &#123; <span class="attr">content</span>: <span class="string">'some detail ...'</span> &#125;</span><br><span class="line">car.contract = exampleContract</span><br><span class="line">car.contract    <span class="comment">// &#123;content: "some detail ..."&#125;</span></span><br></pre></td></tr></table></figure>
<p><code>Object.defineProperty</code> 還有更深入的運用，它可以控制物件屬性的<br>可讀性，可寫性，可枚舉性等低階操作，更完整的介紹請看MDN的<a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener">Object.defineProperty()</a>文件</p>
</div><div class="article-meta" style="max-width:800px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/class/">class</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/object/">object</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oop/">oop</a><span class="tag-list-count">2</span></li></ul></div></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2018/09/02/Babel-7-Released/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2018/08/29/JavaScript-全域變數與屬性/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/cian6390" title="Github" target="_blank"><i class="icon icon-github"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2018 生活與技術<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small><small>, THEME BY <a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank">LAUGHING</a></small></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>