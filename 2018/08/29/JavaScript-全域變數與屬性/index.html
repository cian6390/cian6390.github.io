<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description" content="網頁技術, 前端, 後端, 生活, 閱讀, 筆記"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>JavaScript 全域變數與屬性 - 生活與技術</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com/cian6390"><span>Github</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="https://images2.imgbox.com/e1/ff/W42RCDl2_o.jpg"><div class="post-title"><h1 class="title">JavaScript 全域變數與屬性</h1><ul class="meta"><li><i class="icon icon-author"></i>Cian</li><li><i class="icon icon-clock"></i>5 Minutes</li><li><i class="icon icon-calendar"></i>August 29, 2018</li></ul></div></div><div class="article-content" style="max-width:800px"><p>今天在公司的同事，問了我一個問題<br>當下可能也因為自己觀念不夠清楚，沒能解釋的很明白<br>所以趕緊整理一篇筆記，加深印象</p>
<h2 id="問題"><a href="#問題" class="headerlink" title="問題"></a>問題</h2><p>為什麼以下的程式碼，執行結果會不同</p>
<h3 id="情況一"><a href="#情況一" class="headerlink" title="情況一"></a>情況一</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"say()"</span>&gt;</span>button<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'hello'</span>)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">&#125;)()</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>執行結果 <code>ReferenceError: say is not defined</code></p>
<h3 id="情況二"><a href="#情況二" class="headerlink" title="情況二"></a>情況二</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"say()"</span>&gt;</span>button<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'hello'</span>)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">&#125;)()</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>執行結果 <code>hello</code></p>
<hr>
<h2 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h2><p>要了解這樣的差異必須了解以下幾個關鍵因素</p>
<h3 id="因素一"><a href="#因素一" class="headerlink" title="因素一"></a>因素一</h3><p>在JS中變數作用域是 function級別<br>意思就是說我們宣告一個變數的有效範圍<br>只在宣告的那個 function底下才有效</p>
<h3 id="因素二"><a href="#因素二" class="headerlink" title="因素二"></a>因素二</h3><p>當我們使用匿名函數時該作用域指向全域  </p>
<blockquote>
<p>瀏覽器中的全域指的是 <code>window</code>物件<br>Nodejs中的全域指的是 <code>global</code>物件</p>
</blockquote>
<h3 id="因素三"><a href="#因素三" class="headerlink" title="因素三"></a>因素三</h3><p>使用 <code>var</code>是明確 <strong>宣告</strong>一個變數<br>沒有使用 <code>var</code>時，卻是向該作用指派一個成員 <code>member</code>  </p>
<p>講到這可能有些人已經理解了<br>在瀏覽器當中 <strong>DOM</strong>所綁定的事件對象必須是在 <code>window</code></p>
<p>因此<em>狀況一</em>因為使用立即函示的關係<br>使得其變數有效範圍在該 function之中<br>function外便無法參考到該變數</p>
<p>而<em>狀況二</em>也因為匿名函數的關係<br>使得 function scope指向全域 <code>window</code><br>又因沒有使用 <code>var</code>宣告變數<br>使JS指派了一個屬性 <em>say</em>至當下作用域物件 <code>window</code><br>因此文件中button所觸發的事件便能從 <code>window</code>的屬性中找到了</p>
<p>雖然這麼做使得html中的click事件得以運作<br>但實務中這是一個<code>反模式</code>，為什麼呢？</p>
<p>主要原因在於宣告的變數是無法被刪除的，但物件屬性可以被刪除。<br>其次由於沒有宣告，我們並不明確知道是改變某個變數還是定義新屬性。<br>因此應盡量避免這樣的使用方式。</p>
</div><div class="article-meta" style="max-width:800px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scope/">scope</a><span class="tag-list-count">1</span></li></ul></div></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2018/08/30/JavaScript-類別與物件/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2018/08/19/Javascript-陣列操作/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/cian6390" title="Github" target="_blank"><i class="icon icon-github"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2018 生活與技術<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small><small>, THEME BY <a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank">LAUGHING</a></small></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>